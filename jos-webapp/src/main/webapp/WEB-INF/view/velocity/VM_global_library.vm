#**
 * josMessage
 *
 * Macro to translate a message code into a message.
 *#
#macro( josMessage $code)$springMacroRequestContext.getMessage($code)#end
#macro( josMessageEscaped $code $htmlEscape )$springMacroRequestContext.getMessage($code, null, $htmlEscape)#end

#macro( josMessageArgs $code $args )$springMacroRequestContext.getMessage($code, $args)#end
#macro( josMessageArgsEscaped $code $args $htmlEscape )$springMacroRequestContext.getMessage($code, $args.toArray(), $htmlEscape)#end

#macro( josMessageTextArgs $code $args $text )$springMacroRequestContext.getMessage($code, $args.toArray(), $text)#end
#macro( josMessageTextArgsEscaped $code $args $text $htmlEscape )$springMacroRequestContext.getMessage($code, $args.toArray(), $text, $htmlEscape)#end

#**
 * josUrl
 *
 * Takes a relative URL and makes it absolute from the server root by
 * adding the context root for the web application.
 *#
#macro( josUrl $relativeUrl )$response.encodeURL("#springUrl(${relativeUrl})")#end

#**
 * josFormSingleSelect
 *
 * Show a selectbox (dropdown) input element allowing a single value to be chosen
 * from a list of options.
 *
 * The null check for $status.value leverages Velocity's 'quiet' notation rather
 * than the more common #if($status.value) since this method evaluates to the
 * boolean 'false' if the content of $status.value is the String "false" - not
 * what we want.
 *
 * @param path the name of the field to bind to
 * @param options a map (value=label) of all the available options
 * @param attributes any additional attributes for the element (such as class
 *    or CSS styles or size
*#
#macro( josFormSingleSelect $path $opts $optgroups $attributes )
	#springBind($path)
	#set($selected = false)
	<select name="${status.expression}" ${attributes}>
		<option value=""#if(!$selected && "$!status.value" == "")#set($selected = true) selected="selected"#end>-</option>
		##options
		#foreach($option in $opts.entrySet())
		<option value="${option.key}"#if(!$selected && "$!status.value" == "$option.key")#set($selected = true) selected="selected"#end>$option.value</option>
		#end
		##optgroups
		#foreach($options in $optgroups.entrySet())
		<optgroup label="${options.key}">
			#foreach($option in $options.value.entrySet())
			<option value="${option.key}"#if(!$selected && "$!status.value" == "$option.key")#set($selected = true) selected="selected"#end>$option.value</option>
			#end
		</optgroup>
		#end
	</select>
#end

#**
 * josFormRadioButtons
 *
 * Show radio buttons.
 *
 * @param path the name of the field to bind to
 * @param options a map (value=label) of all the available options
 * @param separator the html tag or other character list that should be used to
 *    separate each option.  Typically '&nbsp;' or '<br>'
 * @param attributes any additional attributes for the element (such as class
 *    or CSS styles or size
*#
#macro( josFormRadioButtons $path $options $separator $attributes )
	#springBind($path)
	#foreach($option in $options.keySet())
		<input type="radio" name="${status.expression}" id="${status.expression}_$velocityCount" value="${option}"
		#if("$!status.value" == "$option")
			checked="checked"
		#end
		${attributes}
		#springCloseTag()
		<label for="${status.expression}_$velocityCount">${options.get($option)}</label> ${separator}
	#end
#end
